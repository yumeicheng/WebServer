# ğŸš€ High-Performance C++ WebServer

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº **Reactor æ¨¡å¼** çš„ Linux é«˜å¹¶å‘ Web æœåŠ¡å™¨ã€‚å®ç°äº† HTTP é™æ€èµ„æºçš„è®¿é—®ã€åŠ¨æ€ç”¨æˆ·ç™»å½•éªŒè¯ã€å¼‚æ­¥æ—¥å¿—è®°å½•ä»¥åŠéæ´»è·ƒè¿æ¥æ¸…ç†ç­‰åŠŸèƒ½ã€‚

é¡¹ç›®ä»é›¶å¼€å§‹æ„å»ºï¼Œæ—¨åœ¨é€šè¿‡æè‡´çš„ IO ä¼˜åŒ–ä¸å¹¶å‘æ¨¡å‹è®¾è®¡ï¼Œæ¢ç´¢æ”¯æ’‘é«˜å¹¶å‘è¯·æ±‚çš„åº•å±‚åŸç†ã€‚

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

*   **è¯­è¨€**ï¼šC++ 20
*   **å¹¶å‘æ¨¡å‹**ï¼šReactor æ¨¡å¼ï¼ˆEpoll ET + ThreadPoolï¼‰
*   **ç½‘ç»œ IO**ï¼šéé˜»å¡ IO + mmap å†…å­˜æ˜ å°„ + writev é›†ä¸­å†™
*   **åè®®è§£æ**ï¼šæœ‰é™çŠ¶æ€æœºï¼ˆFSMï¼‰
*   **æ•°æ®åº“**ï¼šMySQL (RAII æ•°æ®åº“è¿æ¥æ± )
*   **åŒæ­¥æœºåˆ¶**ï¼šä¿¡å·é‡ã€äº’æ–¥é”ã€æ¡ä»¶å˜é‡ã€åŸå­å˜é‡ (Atomic)
*   **å·¥å…·ç»„ä»¶**ï¼šå°æ ¹å †å®šæ—¶å™¨ã€å¼‚æ­¥æ—¥å¿—ç³»ç»Ÿã€åŒæ¸¸æ ‡ Buffer ç¼“å†²åŒº

---

## ğŸ—ï¸ æ ¸å¿ƒæ¶æ„

æœåŠ¡å™¨é‡‡ç”¨ **å¤šçº¿ç¨‹ + éé˜»å¡ IO** çš„æ¶æ„æ–¹æ¡ˆï¼š

*   **ä¸»çº¿ç¨‹**ï¼šåˆ©ç”¨ Epoll è¿›è¡Œ IO å¤šè·¯å¤ç”¨ï¼Œç›‘å¬ `listen_fd` å’Œ `conn_fd`ã€‚
*   **å·¥ä½œçº¿ç¨‹**ï¼šä» `ThreadPool` ä¸­å–å‡ºä»»åŠ¡ï¼Œæ‰§è¡Œå…·ä½“çš„ HttpRequest è§£æã€æ•°æ®åº“æŸ¥è¯¢åŠ HttpResponse å°è£…ã€‚
*   **å®šæ—¶å™¨**ï¼šåˆ©ç”¨å°æ ¹å †ç®¡ç†è¿æ¥ç”Ÿå‘½å‘¨æœŸï¼Œæ¯«ç§’çº§æ¸…ç†åƒµå°¸è¿æ¥ï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æºã€‚
*   **æ—¥å¿—çº¿ç¨‹**ï¼šç‹¬ç«‹çš„åå°çº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—ä¸­æå–æ—¥å¿—ï¼Œæ‰¹é‡å†™å…¥ç£ç›˜ï¼Œé¿å…ç£ç›˜ IO é˜»å¡ä¸šåŠ¡çº¿ç¨‹ã€‚

### ç³»ç»Ÿæ¶æ„å›¾
![é¡¹ç›®æ¶æ„å›¾](./docs/webserver_architecture.png)

---

## âœ¨ æŠ€æœ¯äº®ç‚¹

*   **é«˜æ€§èƒ½ IO ä¼ è¾“**ï¼šä½¿ç”¨ `mmap` å°†é™æ€èµ„æºç›´æ¥æ˜ å°„åˆ°å†…å­˜ï¼Œé…åˆ `writev` å®ç°å“åº”å¤´ä¸æ–‡ä»¶å†…å®¹çš„é›†ä¸­å‘é€ï¼Œå®ç°äº†**é›¶æ‹·è´**æ€æƒ³ï¼Œå¤§å¹…å‡å°‘ç”¨æˆ·æ€/å†…æ ¸æ€çš„æ•°æ®æ‹·è´ã€‚
*   **é«˜æ•ˆåè®®è§£æ**ï¼šæ‰‹å†™**æœ‰é™çŠ¶æ€æœº**è§£æ HTTP è¯·æ±‚æŠ¥æ–‡ï¼Œå¤„ç† TCP ç²˜åŒ…/åŠåŒ…é—®é¢˜ï¼Œæ”¯æŒé•¿è¿æ¥ï¼ˆKeep-Aliveï¼‰ã€‚
*   **æ•°æ®åº“è¿æ¥æ± **ï¼šåŸºäº **RAII** æ€æƒ³å°è£…çš„ MySQL è¿æ¥æ± ï¼Œåˆ©ç”¨ä¿¡å·é‡å®ç°è¿æ¥çš„è·å–ä¸å½’è¿˜ï¼Œæœ‰æ•ˆè§£å†³æ•°æ®åº“çŸ­è¿æ¥å¸¦æ¥çš„æ€§èƒ½å¼€é”€ã€‚
*   **å¼‚æ­¥æ—¥å¿—ç³»ç»Ÿ**ï¼šé‡‡ç”¨å…¸å‹çš„**ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹**ï¼Œä¸šåŠ¡çº¿ç¨‹æ— æ„Ÿè®°å½•æ—¥å¿—ã€‚æ”¯æŒæŒ‰å¤©è‡ªåŠ¨åˆ‡åˆ†æ—¥å¿—æ–‡ä»¶ã€æŒ‰è¡Œæ•°è‡ªåŠ¨æ»šåŠ¨ã€‚
*   **è¾¹ç¼˜è§¦å‘ (ET) + ONESHOT**ï¼šé‡‡ç”¨ Epoll çš„ ET æ¨¡å¼å‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ã€‚é€šè¿‡ `EPOLLONESHOT` è§£å†³å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸åŒçº¿ç¨‹åŒæ—¶æ“ä½œåŒä¸€ Socket çš„ç«æ€é—®é¢˜ã€‚

---

## ğŸ“Š æ€§èƒ½è¡¨ç°

ä½¿ç”¨ **Webbench** åœ¨ WSL2 (Ubuntu 22.04) ç¯å¢ƒä¸‹è¿›è¡Œå‹åŠ›æµ‹è¯•ï¼š

*   **æµ‹è¯•åœºæ™¯**ï¼š1000 å¹¶å‘å®¢æˆ·ç«¯ï¼ŒæŒç»­ 30 ç§’è®¿é—®é™æ€èµ„æºã€‚
*   **æµ‹è¯•ç»“æœ**ï¼š
    *   **QPS (Requests/sec)**: ~1,833
    *   **Succeed**: 55,008
    *   **Failed**: 0
    *   **Throughput**: ~728 KB/sec

> **æ³¨**ï¼šå—é™äºè™šæ‹Ÿæœºç½‘å¡è½¬å‘æŸè€—ï¼Œåœ¨çº¯ Linux ç‰©ç†ç¯å¢ƒå‹æµ‹ä¸‹æ€§èƒ½é¢„è®¡å¯æå‡ 5-10 å€ã€‚

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```text
.
â”œâ”€â”€ src
â”‚   â”œâ”€â”€ base         # åŸºç¡€ç»„ä»¶ (çº¿ç¨‹æ± ã€å®šæ—¶å™¨ã€å®‰å…¨é˜Ÿåˆ—)
â”‚   â”œâ”€â”€ net          # ç½‘ç»œæ ¸å¿ƒ (Epollå°è£…ã€ç¼“å†²åŒºBuffer)
â”‚   â”œâ”€â”€ http         # åè®®å±‚ (è¯·æ±‚è§£æã€å“åº”å°è£…)
â”‚   â”œâ”€â”€ pool         # æ•°æ®åº“è¿æ¥æ± 
â”‚   â””â”€â”€ log          # å¼‚æ­¥æ—¥å¿—ç³»ç»Ÿ
â”œâ”€â”€ resources        # é™æ€èµ„æºæ–‡ä»¶ (HTML, å›¾ç‰‡)
â”œâ”€â”€ main.cpp         # æœåŠ¡å™¨å…¥å£
â””â”€â”€ CMakeLists.txt   # æ„å»ºè„šæœ¬
```
## ğŸ”¨ å¿«é€Ÿå¼€å§‹

* **ç¯å¢ƒè¦æ±‚**:
  * **Ubuntu 20.04+ (or WSL2)**
  * **CMake 3.10+**
  * **MySQL 8.0+**
  * **libmysqlclient-dev**
* **ç¼–è¯‘ä¸è¿è¡Œ**
```
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/yumeicheng/WebServer.git
cd WebServer

# 2. å‡†å¤‡èµ„æºä¸æ•°æ®åº“
mkdir -p build && cp -r resources build/
# åœ¨ MySQL ä¸­åˆ›å»º webdb æ•°æ®åº“å¹¶æ ¹æ®ä»£ç é€»è¾‘å»ºè¡¨

# 3. æ„å»º
cd build
cmake .. && make -j4

# 4. å¯åŠ¨
./WebServer
```
